!function(e,t,n){"use strict";var a,i,r,o,l,s,c,d,u,g,f,m,h,p,v,b,y,x,E,N,S,C,w,k=n.getElementById("mark"),L=n.getElementById("ui"),T=n.getElementById("ui-file"),A=n.getElementById("ui-themes"),H=n.getElementById("ui-tooltip"),F=!1,B={};i=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){"function"==typeof t&&4===n.readyState&&200===n.status&&t(n.responseText)},n.send()},r=function(e){return e.filter(function(t,n){return e.indexOf(t)===n})},n.documentElement.classList?(o=function(e,t){return e.classList.contains(t)},l=function(e,t){e.classList.add(t)},s=function(e,t){e.classList.remove(t)}):(o=function(e,t){return RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},l=function(e,t){o(e,t)||(e.className+=(e.className?" ":"")+t)},s=function(e,t){e.className=e.className.replace(RegExp("(^|\\s)*"+t+"(\\s|$)*","g"),"")}),c=function(e){return S[e]},d=function(){for(var e=L.querySelectorAll("[data-i18n]"),t=e.length;t--;)"INPUT"===e[t].tagName?e[t].placeholder=c(e[t].getAttribute("data-i18n")):(e[t].firstChild&&3===e[t].firstChild.nodeType&&e[t].removeChild(e[t].firstChild),e[t].insertBefore(n.createTextNode(c(e[t].getAttribute("data-i18n"))),e[t].firstChild))},u=function(e,t){var n,a;for(a=0;a<t.childNodes.length;a++)if(e.y+e.margin>297&&(e.y=e.margin+e.lineHeight,e.addPage()),3===t.childNodes[a].nodeType)"\n"!==t.childNodes[a].textContent&&(n=e.splitTextToSize(t.childNodes[a].textContent,210-e.margin-e.x),e.text(e.x,e.y,n[0]),"A"===t.tagName&&(e.setDrawColor(0,0,255),e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y+e.lineHeight/8),e.setDrawColor(0,0,0)),"DEL"===t.tagName&&e.lines([[0,0],[e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,0]],e.x,e.y-e.lineHeight/4),n.length>1?(t.childNodes[a].textContent=t.childNodes[a].textContent.substring(n[0].length).replace(/^\s/,""),e.y+=e.lineHeight,e.x=e.margin,a--):(e.x+=e.getStringUnitWidth(n[0])*e.internal.getFontSize()/e.internal.scaleFactor,e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal"),e.setTextColor(0,0,0)));else{switch(t.childNodes[a].tagName){case"H1":e.setFontSize(24),e.setFontStyle("bold");break;case"H2":e.setFontSize(18),e.setFontStyle("bold");break;case"H3":e.setFontSize(14),e.setFontStyle("bold");break;case"H4":case"H5":case"H6":e.setFontStyle("bold");break;case"HR":e.lines([[0,0],[210-2*e.margin,0]],e.margin,e.y-e.lineHeight/1.5),e.y+=e.lineHeight,e.x=e.margin;break;case"LI":"UL"===t.tagName?(e.setFillColor(0,0,0),e.circle(e.margin-5,e.y-e.lineHeight/4,.7,"F")):e.text(e.x-6,e.y,Array.prototype.indexOf.call(t.children,t.childNodes[a])+1+".");break;case"EM":e.setFontStyle("italic");break;case"STRONG":e.setFontStyle("bold");break;case"A":e.setTextColor(0,0,255);break;case"CODE":e.setFont("courier"),e.setFontSize(10);break;case"IMG":e.text(e.x,e.y,t.childNodes[a].alt||t.childNodes[a].src),e.x+=e.getStringUnitWidth(t.childNodes[a].alt||t.childNodes[a].src)*e.internal.getFontSize()/e.internal.scaleFactor;break;default:e.setFont("helvetica"),e.setFontSize(12),e.setFontStyle("normal")}u(e,t.childNodes[a]),t.childNodes[a].tagName.match(/P|H1|H2|H3|H4|H5|H6|LI/)&&(e.y+="LI"===t.childNodes[a].tagName&&t.childNodes[a].nextElementSibling?e.lineHeight:2*e.lineHeight,e.x=e.margin)}},g=function(){var t,n=new jsPDF,a=k.getElementsByTagName("TEXTAREA")[0];return a&&e.render(a),t=k.cloneNode(!0),n.lineHeight=5.29,n.margin=20,n.x=n.margin,n.y=n.margin+n.lineHeight,n.setProperties({title:h(),author:"Mark",creator:"Mark"}),u(n,t),n.output("datauristring")},f=function(e){if("TEXTAREA"===e.tagName&&e.selectionStart!==e.selectionEnd){var t,a=n.createElement("div"),i=e.value;return i=i.substring(0,e.selectionStart)+'<span id="selection-rect">'+i.substring(e.selectionStart,e.selectionEnd)+"</span>"+i.substring(e.selectionEnd),a.innerHTML=i.replace(/\n/g,"<br>"),a.className=e.className,e.parentNode.insertBefore(a,e),t=n.getElementById("selection-rect").getBoundingClientRect(),e.parentNode.removeChild(a),t}},m=function(){var t,a,i,r=n.createElement("div");for(r.innerHTML=e.getHTML(),t=r.getElementsByTagName("br"),i=t.length;i--;)t[i].parentNode.replaceChild(n.createTextNode("\n"),t[i]);return a=r.textContent,{characters:a.replace(/\n/g,"").length,words:a.split(/[\s\n]/).filter(function(e){return""!==e}).length}},h=function(e){var t;return"H1"===k.firstChild.tagName&&k.firstChild.textContent?(t=k.firstChild.textContent,e&&(t=t.toLowerCase().replace(/\s/g,"-"))):t=c("default-filename"),t},p=function(e,t){var a,i,r,o=n.getElementById("ui-"+(t?"modal":"notice")),c=function(e){e&&"keydown"===e.type&&27!==e.keyCode||(s(o,"fade-in--show"),n.removeEventListener("keydown",c,!1))},d=o.firstElementChild.firstElementChild,u=o.firstElementChild.lastElementChild;if(d.innerHTML=e,l(o,"fade-in--show"),t){for(a=n.createDocumentFragment();u.firstChild;)u.removeChild(u.firstChild);for(r=t.length;r--;)i=n.createElement("button"),i.textContent=t[r].text,t[r].className&&(i.className=t[r].className),t[r].clickHandler&&i.addEventListener("click",t[r].clickHandler,!1),i.addEventListener("click",c,!1),a.insertBefore(i,a.firstChild);u.appendChild(a),n.addEventListener("keydown",c,!1)}else o.addEventListener("click",c,!1),setTimeout(c,8e3);return o},v=function(){var t=e.getText();return"<br>"!==t&&C!==t},b=function(e,t,a,i){var r=n.createElement("a");void 0!==r.download?(r.href=i?e:"data:"+a+";charset=utf-8,"+encodeURIComponent(e),r.download=h(!0)+"."+t,n.body.appendChild(r),r.click(),n.body.removeChild(r)):navigator.onLine&&(r.innerHTML='<form method="POST" action="server/download-fallback.php"><input type="hidden" name="content" value="'+e.replace(/"/g,"&quot;")+'"><input type="hidden" name="extension" value="'+t+'"><input type="hidden" name="mime-type" value="'+a+'"><input type="hidden" name="filename" value="'+h(!0)+'"><input type="hidden" name="data-url" value="'+(i||!1)+'"></form>',n.body.appendChild(r),r.firstChild.submit(),n.body.removeChild(r))},y=function(t){switch(C=e.getText(),t){case"txt":b(C,"txt","text/plain");break;case"html":b(e.getHTML(),"html","text/html");break;case"pdf":g(),b(g(),"pdf","application/pdf",!0)}},x=function(t){for(var n,a;k.firstChild;)k.removeChild(k.firstChild);if(t)for(n=e.convert(t),a=n.length;a--;)k.insertBefore(n[a],k.firstChild);else e.newline()},E=function(e){if(!FileReader)return void p(c("feature-not-supported"));var t,n=new FileReader,a=e.name.split(".").pop().toUpperCase();"text/plain"===e.type||"MD"===a||"MARKDOWN"===a?(n.onload=function(){t=n.result,v()?p(c("delete-warning"),[{text:c("delete-text"),clickHandler:function(){x(t)}},{text:c("cancel")},{text:c("export-text"),clickHandler:function(){y("txt"),x(t)},className:"button--active"}]):x(t)},n.readAsText(e)):p(c("file-type-not-supported"))},N=function(t,n,a){var i=new XMLHttpRequest;C=e.getText(),i.open("POST","server/mail.php",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onload=function(){if(4===i.readyState&&200===i.status)switch(i.responseText){case"on_cooldown":p(c("mail-on-cooldown"));break;case"error":p(c("mail-error"));break;case"success":p(c("mail-sent"))}},i.send("address="+t+"&subject="+(encodeURIComponent(n)||c("mail-default-subject"))+"&message="+(encodeURIComponent(a)||c("mail-default-message"))+"\n\n---\n"+c("mail-footnote")+"&attachment="+encodeURIComponent(C)+"&filename="+h(!0))},e.init(k),i("languages/languages.json",function(e){for(var t,a=JSON.parse(e),r=navigator.onLine?localStorage.languageFile:a[0].file,o=n.getElementById("ui-languages-list"),l=a.length,s=n.createDocumentFragment(),c=function(){var e=this;i(e.getAttribute("data-file"),function(t){localStorage.languageFile=e.getAttribute("data-file"),localStorage.languageDictionary=e.getAttribute("data-dictionary"),S=JSON.parse(t),d()})};l--;)t=n.createElement("li"),t.setAttribute("data-file",a[l].file),t.setAttribute("data-dictionary",a[l].dictionary||""),t.textContent=a[l].name,t.addEventListener("click",c,!1),s.insertBefore(t,s.firstChild),r||-1===a[l].identifiers.indexOf((navigator.language||navigator.userLanguage).toLowerCase())&&l||(localStorage.languageFile=r=a[l].file,localStorage.languageDictionary=a[l].dictionary);o.insertBefore(s,o.firstChild),i(r,function(e){S=JSON.parse(e),d()})}),i("themes/themes.json",function(a){var i,r=JSON.parse(a),o=navigator.onLine?r.length:1,c=n.createDocumentFragment(),d=n.createElement("link"),u=function(){var e=this;localStorage.themeFile=e.getAttribute("data-file"),localStorage.themeUi=e.getAttribute("data-ui"),n.getElementById("theme").href=localStorage.themeFile,s(L,"ui-"+("dark"===localStorage.themeUi?"light":"dark")),l(L,"ui-"+localStorage.themeUi),e.parentNode.getElementsByClassName("active-theme")[0].removeAttribute("class"),e.className="active-theme"},g=function(){l(L,"ui-"+localStorage.themeUi),localStorage.saveState&&"<br>"!==localStorage.saveState?x(localStorage.saveState):e.newline(),d.removeEventListener("load",g,!1)};for(localStorage.themeFile&&navigator.onLine||(localStorage.themeFile=r[0].folder+"theme.css",localStorage.themeUi=r[0].ui),d.id="theme",d.rel="stylesheet",d.href=localStorage.themeFile,d.addEventListener("load",g,!1),n.head.appendChild(d);o--;)i=n.createElement("li"),i.setAttribute("data-file",r[o].folder+"theme.css"),i.setAttribute("data-fonts",r[o].fonts.join(",")),i.setAttribute("data-ui",r[o].ui),i.style.backgroundImage='url("'+r[o].folder+"preview"+(navigator.onLine&&t.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 1.5dppx)").matches?"@2x":"")+'.png")',i.textContent=r[o].name,i.getAttribute("data-file")===localStorage.themeFile&&(i.className="active-theme"),i.addEventListener("click",u,!1),c.insertBefore(i,c.firstChild);n.getElementById("ui-themes-list").appendChild(c)}),t.addEventListener("beforeunload",function(){localStorage.saveState=e.getText()},!1),navigator.onLine||l(n.body,"offline"),t.addEventListener("offline",function(){l(n.body,"offline")},!1),t.addEventListener("online",function(){s(n.body,"offline")},!1),T.addEventListener("click",function(e){if(navigator.onLine||!o(e.target,"online-only"))if(e.target.id)switch(s(L.parentNode,"frame--show-file"),e.target.id){case"ui-export-txt":y("txt");break;case"ui-export-html":y("html");break;case"ui-export-pdf":setTimeout(function(){y("pdf")},300);break;case"ui-new":v()?p(c("delete-warning"),[{text:c("delete-text"),clickHandler:function(){x()}},{text:c("cancel")},{text:c("export-text"),clickHandler:function(){y("txt"),x()},className:"button--active"}]):x();break;case"ui-mail":p('<label class="font-caps" for="ui-mail-email">'+c("mail-address")+'</label><input id="ui-mail-email" class="font-helvetica font-size-regular" type="email" value="'+(localStorage.email||"")+'"><label class="font-caps" for="ui-mail-subject">'+c("mail-subject")+'</label><input id="ui-mail-subject" class="font-helvetica font-size-regular" type="email"><label class="font-caps" for="ui-mail-message">'+c("mail-text")+'</label><textarea id="ui-mail-message" class="font-helvetica font-size-regular"></textarea>',[{text:c("cancel")},{text:c("send"),clickHandler:function(e){var t=n.getElementById("ui-mail-email");/\S+@\S+\.\S+/.test(t.value)?(s(t,"validation-error"),localStorage.email=t.value,N(t.value,n.getElementById("ui-mail-subject").value,n.getElementById("ui-mail-message").value)):(e.stopImmediatePropagation(),l(t,"validation-error"))},className:"button--active"}]);break;case"ui-about":v()?p(c("delete-warning"),[{text:c("delete-text"),clickHandler:function(){x(c("about-text"))}},{text:c("cancel")},{text:c("export-text"),clickHandler:function(){y("txt"),x(c("about-text"))},className:"button--active"}]):x(c("about-text"))}else if(o(e.target,"menu__sublist"))if(e.target.style.height)e.target.removeAttribute("style");else{var t=this.querySelector("[style]");t&&t.removeAttribute("style"),e.target.style.height=52*(e.target.lastElementChild.children.length+1)+"px"}},!1),n.getElementById("ui-custom-theme").addEventListener("click",function(){s(L.parentNode,"frame--show-themes"),v()?p(c("delete-warning"),[{text:c("delete-text"),clickHandler:function(){x(c("create-a-custom-theme-text"))}},{text:c("cancel")},{text:c("export-text"),clickHandler:function(){y("txt"),x(c("create-a-custom-theme-text"))},className:"button--active"}]):x(c("create-a-custom-theme-text"))},!1),n.getElementById("ui-themes-filter").addEventListener("input",function(){for(var e=this,t=e.nextElementSibling,n=t.children.length,a=0;n--;)-1!==t.children[n].textContent.toLowerCase().indexOf(e.value.toLowerCase())||-1!==t.children[n].getAttribute("data-fonts").toLowerCase().indexOf(e.value.toLowerCase())?(t.children[n].style.display="block",a++):t.children[n].style.display="none";t.nextElementSibling.style.display=a?"none":"block"},!1),n.getElementById("ui-open").addEventListener("change",function(){E(this.files[0]),this.parentNode.reset()},!1),n.addEventListener("dragover",function(e){"TEXTAREA"!==e.target.tagName&&e.preventDefault()},!1),n.addEventListener("dragenter",function(e){"TEXTAREA"!==e.target.tagName&&l(k,"dragover")},!1),n.addEventListener("dragleave",function(e){e.target===k&&s(k,"dragover")},!1),n.addEventListener("drop",function(t){if("TEXTAREA"!==t.target.tagName){t.preventDefault();var n,a,i;t.dataTransfer.files[0]?E(t.dataTransfer.files[0]):(i=t.dataTransfer.getData("URL")||t.dataTransfer.getData("TEXT"),a=k.getElementsByTagName("TEXTAREA")[0]||k,i&&(n=i.split(".").pop().toUpperCase(),n.match(/BMP|GIF|JPG|JPEG|PNG|SVG/)&&(i="![]("+i+")"),"TEXTAREA"===a.tagName?a.value+=i:e.newline(i))),s(k,"dragover")}},!1),k.addEventListener("select",function(e){if(localStorage.languageDictionary&&"TEXTAREA"===e.target.tagName){var a=e.target.value.substring(e.target.selectionStart,e.target.selectionEnd).trim();(a.match(/\s/g)||[]).length<2&&a.length>1&&a.length<20&&i("server/sinonimi/service.php?word="+encodeURIComponent(a)+"&language="+localStorage.languageDictionary+"&output=json",function(a){if(a=JSON.parse(a),a.response){var i,o,c={},d=f(e.target),u=function(){s(H.parentNode,"fade-in--show"),n.removeEventListener("keydown",u,!1),n.removeEventListener("mouseup",u,!1),n.removeEventListener("drop",u,!1),k.removeEventListener("scroll",u,!1)},g=a.response.length,m="";for(o=0;g>o;o++)c.hasOwnProperty(a.response[o].list.category)||(c[a.response[o].list.category]=[]),c[a.response[o].list.category]=r(c[a.response[o].list.category].concat(a.response[o].list.synonyms.replace(/\s\(\w+\)/g,"").split("|")));m+='<div class="tooltip__container scroll">';for(i in c)c.hasOwnProperty(i)&&(m+='<span class="tooltip__category font-caps">'+i.replace(/[\(\)]/g,"")+"</span>",m+='<ul class="font-size-medium no-bullets"><li>'+c[i].join("</li><li>")+"</li></ul>");m+="</div>",n.addEventListener("keydown",u,!1),n.addEventListener("mouseup",u,!1),n.addEventListener("drop",u,!1),k.addEventListener("scroll",u,!1),H.innerHTML=m,H.style.left=d.left+d.width/2-H.offsetWidth/2+"px",d.top+H.offsetHeight+50>t.innerHeight?(l(H,"tooltip--top"),H.style.top=d.top-d.height-H.offsetHeight+"px"):(s(H,"tooltip--top"),H.style.top=d.top+d.height+"px"),l(H.parentNode,"fade-in--show")}})}},!1),H.addEventListener("mouseup",function(e){var t,n;"LI"===e.target.tagName&&(t=k.getElementsByTagName("TEXTAREA")[0],n=t.selectionStart,t.value=t.value.substring(0,n)+e.target.textContent+t.value.substring(t.selectionEnd),t.setSelectionRange(n+e.target.textContent.length,n+e.target.textContent.length))},!1),t.hasOwnProperty("ontouchstart")||navigator.msMaxTouchPoints?(l(n.body,"touch"),n.addEventListener("touchstart",function(e){B.x=e.changedTouches[0].pageX,B.y=e.changedTouches[0].pageY},!1),n.addEventListener("touchend",function(e){var t=B.x-e.changedTouches[0].pageX,n=B.y-e.changedTouches[0].pageY;Math.abs(t)>Math.abs(n)&&(t>0?o(L.parentNode,"frame--show-file")?s(L.parentNode,"frame--show-file"):l(L.parentNode,"frame--show-themes"):o(L.parentNode,"frame--show-themes")?s(L.parentNode,"frame--show-themes"):l(L.parentNode,"frame--show-file"))},!1)):(l(n.body,-1!==navigator.appVersion.indexOf("Mac")?"os-mac":"os-other"),T.addEventListener("mouseenter",function(){var e=m();n.getElementById("ui-counter-characters").textContent=e.characters,n.getElementById("ui-counter-words").textContent=e.words,l(L.parentNode,"frame--show-file")},!1),T.addEventListener("mouseleave",function(){var e=this.querySelector("[style]");e&&e.removeAttribute("style"),s(L.parentNode,"frame--show-file")},!1),A.addEventListener("mouseenter",function(){l(L.parentNode,"frame--show-themes")},!1),A.addEventListener("mouseleave",function(){s(L.parentNode,"frame--show-themes")},!1),n.addEventListener("mousemove",function(){F||(l(L.parentNode,"mouse-moved"),F=!0),clearTimeout(w),w=setTimeout(function(){s(L.parentNode,"mouse-moved"),F=!1},1e3)},!1),a=n.createElement("textarea"),a.id="ui-clipboarddata",a.className="clipboarddata",L.appendChild(a),n.addEventListener("keydown",function(t){if(t.metaKey||t.ctrlKey)switch("TEXTAREA"!==t.target.tagName&&"INPUT"!==t.target.tagName&&(a.value=e.getText(),a.setSelectionRange(0,a.value.length),a.focus()),t.keyCode){case 69:t.preventDefault(),y(t.altKey?"html":t.shiftKey?"pdf":"txt");break;case 68:t.preventDefault(),n.getElementById("ui-new").click();break;case 67:t.target===a&&p(c("saved-to-clipboard"));break;case 77:t.preventDefault(),n.getElementById("ui-mail").click();break;case 83:t.preventDefault(),p(c("save-notification"))}},!1),n.addEventListener("keyup",function(e){e.target===a&&a.blur()}))}(Mark,window,document);
